@startuml Realtime_Processor
title Realtime Processor (Pass-Through with Dedup Check)
participant "Input\nQueue" as input
participant "Realtime\nProcessor" as processor
participant "Dedup\nTable" as dedup
participant "Storage\nQueue" as storage
participant "Metrics" as metrics
participant "Event\nPool" as pool

loop For Each Event
  input -> processor: pop()
  note right of input: Lock-free SPSC
  
  processor -> dedup: is_duplicate(id)
  note right of dedup: Lock-free read\nO(1) average
  
  alt Duplicate
    dedup -> processor: true
    processor -> storage: skip
    note right of processor: Drop duplicate
  else New Event
    dedup -> processor: false
    processor -> processor: Process event\n(business logic)
    note right of processor: 15-30Î¼s
    
    processor -> storage: push(event)
    note right of storage: Lock-free SPSC
    
    processor -> metrics: local_count++
    note right of metrics: Thread-local\nNo lock!
  end
  
  storage -> pool: ~Event()\nreturn to pool
  note right of pool: Automatic RAII
end

note over input, pool: Throughput: 27K eps | Latency p99: <1ms

@enduml
