app_name: "EventStreamCore"
version: "1.0.0"
description: "Core library for Event Stream processing"
author: "Van Luu"

logging:
  level: INFO
  pattern: "[%Y-%m-%d %H:%M:%S.%e] [%^%l%$] %v"

ingestion:
  tcp:
    host: "127.0.0.1"
    port: 9000
    enable: true
    maxConnections: 1000

  udp:
    host: "127.0.0.1"
    port: 9001
    enable: true
    bufferSize: 1048576

  file:
    path: "/var/log/eventstream/input.log"
    enable: true
    poll_interval_ms: 1000

router:
  shards: 4
  strategy: "hash_modulo"
  buffer_size: 262144

rule_engine:
  threads: 8
  enable_cache: true
  cache_size: 10000
  rules_file: "/etc/eventstream/rules.json"

storage:
  backend: "sqlite"
  sqlite_path: "data/eventstream.db"
  path: "data/events.bin"

python_integration:
  enable: true
  script_path: "/etc/eventstream/plugins/"

broadcast:
  tcp_push:
    host: "255.255.255.0"
    port: 9100
    enable: false
  websocket_push:
    host: "255.255.255.0"
    port: 9200
    enable: true

plugins:
  load:
    - "plugins/plugins.so"


# For systems with multiple NUMA nodes, bind threads to specific nodes for better performance
# This reduces remote memory access latency from ~300ns to ~50ns on multi-socket systems
numa:
  enable: false                        # Set to true to enable NUMA binding
  dispatcher_node: 0                   # NUMA node for dispatcher thread (-1 to disable)
  ingest_node: 0                       # NUMA node for TCP ingest threads (-1 to disable)
  realtime_proc_node: 0                # NUMA node for realtime processor (-1 to disable)
  transactional_proc_node: 0           # NUMA node for transactional processor (-1 to disable)
  batch_proc_node: 0                   # NUMA node for batch processor (-1 to disable)

# Control Plane Configuration
# Admin loop monitors system health and takes corrective actions
control:
  # Health check interval in seconds
  health_check_interval_sec: 10
  
  # Thresholds for control decisions
  thresholds:
    # Maximum queue depth before taking action (events)
    max_queue_depth: 5000
    
    # Maximum drop rate before taking action (percentage)
    max_drop_rate: 2.0
    
    # Maximum acceptable latency in milliseconds
    max_latency_ms: 100
    
    # Minimum events before evaluating drop rate (avoids false positives)
    min_events_for_evaluation: 1000
    
    # Recovery factor (0.8 = recover when metrics drop to 80% of threshold)
    recovery_factor: 0.8

  # Action policies
  policies:
    # Whether to automatically resume after recovery
    auto_resume: true
    
    # Maximum consecutive unhealthy cycles before emergency
    max_unhealthy_cycles: 5
    
    # Whether to log detailed metrics every cycle
    verbose_logging: false
