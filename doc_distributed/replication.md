# ğŸ“‹ Log Replication

> How data is replicated across cluster nodes.

---

## ğŸ¯ Replication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REPLICATION PIPELINE                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Client â”‚â”€â”€â”€â–ºâ”‚ Leader â”‚â”€â”€â”€â–ºâ”‚  Log   â”‚â”€â”€â”€â–ºâ”‚Replicateâ”€â”€â”€â–ºâ”‚Commit â”‚ â”‚
â”‚  â”‚        â”‚    â”‚        â”‚    â”‚ Append â”‚    â”‚        â”‚    â”‚       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                           â”‚     â”‚
â”‚                                   â”‚                           â–¼     â”‚
â”‚                                   â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                   â”‚                    â”‚   Apply   â”‚â”‚
â”‚                                   â”‚                    â”‚   State   â”‚â”‚
â”‚                                   â”‚                    â”‚  Machine  â”‚â”‚
â”‚                                   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                   â”‚                                  â”‚
â”‚                                   â–¼                                  â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                         â”‚   Followers     â”‚                         â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚                         â”‚  â”‚ Follower 1â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚ Follower 2â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚ Follower Nâ”‚  â”‚                         â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Write Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚     â”‚ Leader â”‚     â”‚Followerâ”‚     â”‚Followerâ”‚
â”‚        â”‚     â”‚        â”‚     â”‚   1    â”‚     â”‚   2    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚              â”‚              â”‚              â”‚
    â”‚  Write(event)â”‚              â”‚              â”‚
    â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚              â”‚              â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  1. Append to local log     â”‚
    â”‚              â”‚â”€â”€â”€â”€â”€â”        â”‚              â”‚
    â”‚              â”‚     â”‚        â”‚              â”‚
    â”‚              â”‚â—„â”€â”€â”€â”€â”˜        â”‚              â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  2. Send AppendEntries      â”‚
    â”‚              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  â”‚
    â”‚              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚             â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  3. Followers append        â”‚
    â”‚              â”‚              â”‚â”€â”€â”€â”€â”€â”        â”‚
    â”‚              â”‚              â”‚     â”‚        â”‚â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚â—„â”€â”€â”€â”€â”˜        â”‚     â”‚
    â”‚              â”‚              â”‚              â”‚â—„â”€â”€â”€â”€â”˜
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  4. Send ACK â”‚              â”‚
    â”‚              â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
    â”‚              â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚              â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  5. Majority ACK = Committed
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  6. Apply to state machine  â”‚
    â”‚              â”‚â”€â”€â”€â”€â”€â”        â”‚              â”‚
    â”‚              â”‚     â”‚        â”‚              â”‚
    â”‚              â”‚â—„â”€â”€â”€â”€â”˜        â”‚              â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚  7. Respond  â”‚              â”‚              â”‚
    â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚              â”‚              â”‚
    â”‚   Success    â”‚              â”‚              â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  8. Notify commit index     â”‚
    â”‚              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  â”‚
    â”‚              â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚             â”‚
    â”‚              â”‚              â”‚              â”‚
    â”‚              â”‚  9. Followers apply         â”‚
    â”‚              â”‚              â”‚â”€â”€â”€â”€â”€â”        â”‚
    â”‚              â”‚              â”‚     â”‚        â”‚â”€â”€â”€â”€â”€â”
    â”‚              â”‚              â”‚â—„â”€â”€â”€â”€â”˜        â”‚     â”‚
    â”‚              â”‚              â”‚              â”‚â—„â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Log Consistency

### Matching Property

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOG MATCHING PROPERTY                             â”‚
â”‚                                                                      â”‚
â”‚  If two logs have an entry with the same index and term,            â”‚
â”‚  then the logs are identical in all entries up to that index.       â”‚
â”‚                                                                      â”‚
â”‚  Leader Log:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ 1:1 â”‚ 2:1 â”‚ 3:1 â”‚ 4:2 â”‚ 5:2 â”‚ 6:2 â”‚ 7:3 â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚    â–²                                                                 â”‚
â”‚    â””â”€ Index:Term                                                    â”‚
â”‚                                                                      â”‚
â”‚  Follower matches at index 5, term 2:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ 1:1 â”‚ 2:1 â”‚ 3:1 â”‚ 4:2 â”‚ 5:2 â”‚  â† Guaranteed identical to leader â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                      â”‚
â”‚  This allows efficient consistency check:                           â”‚
â”‚  - Leader sends: prevLogIndex=5, prevLogTerm=2                      â”‚
â”‚  - Follower checks: log[5].term == 2? âœ“                             â”‚
â”‚  - If match: append new entries                                     â”‚
â”‚  - If no match: reject, leader decrements and retries              â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Conflict Resolution

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONFLICT RESOLUTION                               â”‚
â”‚                                                                      â”‚
â”‚  Scenario: Follower has stale entries after network partition       â”‚
â”‚                                                                      â”‚
â”‚  Leader (term 3):                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ 1:1 â”‚ 2:1 â”‚ 3:1 â”‚ 4:2 â”‚ 5:2 â”‚ 6:3 â”‚ 7:3 â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                      â”‚
â”‚  Stale Follower (was candidate in term 2):                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ 1:1 â”‚ 2:1 â”‚ 3:1 â”‚ 4:2 â”‚ 5:2 â”‚ 6:2 â”‚  â† Conflict at index 6     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                        â•³                             â”‚
â”‚                                   Mismatch!                          â”‚
â”‚                                                                      â”‚
â”‚  Resolution steps:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Leader sends AppendEntries(prevLogIndex=6, prevLogTerm=3)â”‚   â”‚
â”‚  â”‚  2. Follower: log[6].term=2 â‰  3 â†’ Reject                    â”‚   â”‚
â”‚  â”‚  3. Leader decrements: prevLogIndex=5                        â”‚   â”‚
â”‚  â”‚  4. Leader sends AppendEntries(prevLogIndex=5, prevLogTerm=2)â”‚   â”‚
â”‚  â”‚  5. Follower: log[5].term=2 == 2 â†’ Accept                   â”‚   â”‚
â”‚  â”‚  6. Follower deletes entries 6+ and appends leader's entriesâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  After resolution:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ 1:1 â”‚ 2:1 â”‚ 3:1 â”‚ 4:2 â”‚ 5:2 â”‚ 6:3 â”‚ 7:3 â”‚  â† Matches leader     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE MACHINE APPLICATION                         â”‚
â”‚                                                                      â”‚
â”‚  Committed Log Entry â”€â”€â”€â–º Apply to State Machine                    â”‚
â”‚                                                                      â”‚
â”‚  EventStreamCore State Machine:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   Command: SET_EVENT                                         â”‚   â”‚
â”‚  â”‚   â”œâ”€ Store event in local storage                            â”‚   â”‚
â”‚  â”‚   â””â”€ Route to appropriate queue                              â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   Command: DEDUP_ADD                                         â”‚   â”‚
â”‚  â”‚   â””â”€ Add event_id to deduplication set                       â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   Command: DEDUP_EXPIRE                                      â”‚   â”‚
â”‚  â”‚   â””â”€ Remove old entries from dedup set                       â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   Command: CONFIG_UPDATE                                     â”‚   â”‚
â”‚  â”‚   â””â”€ Update runtime configuration                            â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  State Machine Guarantees:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ“ Same commands applied in same order â†’ Same state         â”‚   â”‚
â”‚  â”‚  âœ“ Deterministic execution (no randomness, no time-based)   â”‚   â”‚
â”‚  â”‚  âœ“ All nodes converge to identical state                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¸ Snapshots

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOG COMPACTION                                    â”‚
â”‚                                                                      â”‚
â”‚  Problem: Log grows unbounded                                        â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1  â”‚  2  â”‚  3  â”‚ ... â”‚ 999 â”‚1000 â”‚1001 â”‚1002 â”‚1003 â”‚1004 â”‚1005â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜ â”‚
â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚                     Log keeps growing!                               â”‚
â”‚                                                                      â”‚
â”‚  Solution: Periodic snapshots                                        â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   Snapshot at index 1000:                                    â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚   â”‚
â”‚  â”‚   â”‚  Full state machine state       â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚  - All events                   â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚  - Dedup set                    â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚  - Configuration                â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚  lastIncludedIndex: 1000        â”‚                        â”‚   â”‚
â”‚  â”‚   â”‚  lastIncludedTerm: 5            â”‚                        â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   Delete entries 1-1000                                      â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  After snapshot:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Snapshot     â”‚  â”‚1001 â”‚1002 â”‚1003 â”‚1004 â”‚1005 â”‚                â”‚
â”‚  â”‚ (index 1000)   â”‚  â”‚     â”‚     â”‚     â”‚     â”‚     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Performance Tuning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REPLICATION PERFORMANCE                           â”‚
â”‚                                                                      â”‚
â”‚  Factors affecting replication latency:                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   1. Network RTT between nodes                               â”‚   â”‚
â”‚  â”‚      - Same datacenter: 0.1-1ms                              â”‚   â”‚
â”‚  â”‚      - Cross-datacenter: 10-100ms                            â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   2. Disk sync latency (if wal_sync=true)                    â”‚   â”‚
â”‚  â”‚      - SSD: 0.1-1ms                                          â”‚   â”‚
â”‚  â”‚      - HDD: 5-10ms                                           â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚   3. Batch size                                              â”‚   â”‚
â”‚  â”‚      - Larger batches = higher throughput                    â”‚   â”‚
â”‚  â”‚      - Smaller batches = lower latency                       â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Recommended settings by use case:                                   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    Use Case     â”‚   wal_sync     â”‚      batch_size            â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Financial      â”‚     true       â”‚        1 (per-event)       â”‚  â”‚
â”‚  â”‚  IoT/Metrics    â”‚     false      â”‚       100 (batch)          â”‚  â”‚
â”‚  â”‚  Logging        â”‚     false      â”‚       1000 (high batch)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Guarantees

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONSISTENCY GUARANTEES                            â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  âœ“ Linearizability                                           â”‚   â”‚
â”‚  â”‚    All operations appear to execute atomically at some       â”‚   â”‚
â”‚  â”‚    point between invocation and response                     â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  âœ“ Durability                                                 â”‚   â”‚
â”‚  â”‚    Once committed, data survives any minority of failures    â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  âœ“ Consistency                                                â”‚   â”‚
â”‚  â”‚    All nodes have identical state after applying same log    â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  âœ“ Availability                                               â”‚   â”‚
â”‚  â”‚    System available as long as majority of nodes are up      â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  What Raft does NOT guarantee:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  âœ— Total availability during majority failure                â”‚   â”‚
â”‚  â”‚  âœ— Bounded latency (depends on network/disk)                 â”‚   â”‚
â”‚  â”‚  âœ— Read scaling (all reads go to leader)                     â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š See Also

- [Raft Consensus](raft.md) - Algorithm details
- [Cluster Setup](cluster.md) - Configuration
- [Core Architecture](../doc_core/architecture.md) - System overview
