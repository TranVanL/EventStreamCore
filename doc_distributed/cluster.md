# ğŸ–¥ï¸ Cluster Setup

> Configure and deploy multi-node EventStreamCore cluster.

---

## ğŸ¯ Cluster Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RECOMMENDED TOPOLOGY                              â”‚
â”‚                                                                      â”‚
â”‚  3-node cluster (minimum for fault tolerance):                      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚    â”‚
â”‚  â”‚         â”‚   Node 1    â”‚                                     â”‚    â”‚
â”‚  â”‚         â”‚   Leader    â”‚                                     â”‚    â”‚
â”‚  â”‚         â”‚ 10.0.0.1    â”‚                                     â”‚    â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                     â”‚    â”‚
â”‚  â”‚                â”‚                                             â”‚    â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚    â”‚
â”‚  â”‚       â”‚                 â”‚                                    â”‚    â”‚
â”‚  â”‚       â–¼                 â–¼                                    â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚    â”‚
â”‚  â”‚ â”‚  Node 2   â”‚     â”‚  Node 3   â”‚                             â”‚    â”‚
â”‚  â”‚ â”‚ Follower  â”‚     â”‚ Follower  â”‚                             â”‚    â”‚
â”‚  â”‚ â”‚ 10.0.0.2  â”‚     â”‚ 10.0.0.3  â”‚                             â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  Fault tolerance: 1 node can fail                                   â”‚
â”‚  Quorum: 2 nodes (majority of 3)                                    â”‚
â”‚                                                                      â”‚
â”‚  5-node cluster (recommended for production):                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                â”‚    â”‚
â”‚  â”‚                    â”‚Node 1 â”‚                                â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”¬â”€â”€â”€â”˜                                â”‚    â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚    â”‚
â”‚  â”‚         â”‚              â”‚              â”‚                      â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”               â”‚    â”‚
â”‚  â”‚    â”‚ Node 2  â”‚    â”‚ Node 3  â”‚    â”‚ Node 4  â”‚               â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚
â”‚  â”‚                        â”‚                                    â”‚    â”‚
â”‚  â”‚                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                               â”‚    â”‚
â”‚  â”‚                   â”‚ Node 5  â”‚                               â”‚    â”‚
â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  Fault tolerance: 2 nodes can fail                                  â”‚
â”‚  Quorum: 3 nodes (majority of 5)                                    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ Configuration

### cluster.yaml

```yaml
# Cluster configuration
cluster:
  # Unique node identifier (must be different for each node)
  node_id: 1
  
  # All nodes in the cluster
  nodes:
    - id: 1
      host: 10.0.0.1
      client_port: 9000     # Client connections
      cluster_port: 9100    # Inter-node communication
      
    - id: 2
      host: 10.0.0.2
      client_port: 9000
      cluster_port: 9100
      
    - id: 3
      host: 10.0.0.3
      client_port: 9000
      cluster_port: 9100

  # Raft timing (milliseconds)
  raft:
    election_timeout_min: 150
    election_timeout_max: 300
    heartbeat_interval: 50
    rpc_timeout: 100

  # Log persistence
  storage:
    data_dir: /var/lib/eventstream/raft
    wal_sync: true          # fsync after each write
    snapshot_interval: 1000  # Entries between snapshots

# Network settings
network:
  max_connections: 1000
  tcp_nodelay: true
  keepalive: true
```

---

## ğŸš€ Deployment

### Step 1: Prepare Nodes

```bash
# On each node
mkdir -p /var/lib/eventstream/raft
chown eventstream:eventstream /var/lib/eventstream

# Copy binary and config
scp event_stream_core node1:/opt/eventstream/
scp cluster.yaml node1:/opt/eventstream/config/
```

### Step 2: Start Cluster

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STARTUP SEQUENCE                                 â”‚
â”‚                                                                      â”‚
â”‚  Timeline:                                                           â”‚
â”‚                                                                      â”‚
â”‚  t=0s        t=1s        t=2s        t=3s        t=4s               â”‚
â”‚    â”‚           â”‚           â”‚           â”‚           â”‚                 â”‚
â”‚    â–¼           â”‚           â”‚           â”‚           â”‚                 â”‚
â”‚  Node 1 â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚           â”‚                 â”‚
â”‚  starts        â”‚           â”‚           â”‚           â”‚                 â”‚
â”‚    â”‚           â–¼           â”‚           â”‚           â”‚                 â”‚
â”‚    â”‚        Node 2 â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚                 â”‚
â”‚    â”‚        starts         â”‚           â”‚           â”‚                 â”‚
â”‚    â”‚           â”‚           â–¼           â”‚           â”‚                 â”‚
â”‚    â”‚           â”‚        Node 3 â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚                 â”‚
â”‚    â”‚           â”‚        starts         â”‚           â”‚                 â”‚
â”‚    â”‚           â”‚           â”‚           â–¼           â”‚                 â”‚
â”‚    â”‚           â”‚           â”‚     Election â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
â”‚    â”‚           â”‚           â”‚     (150-300ms)       â”‚                 â”‚
â”‚    â”‚           â”‚           â”‚           â”‚           â–¼                 â”‚
â”‚    â”‚           â”‚           â”‚           â”‚     Leader elected         â”‚
â”‚    â”‚           â”‚           â”‚           â”‚     Cluster ready          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# Node 1
ssh node1 "/opt/eventstream/event_stream_core \
  --node-id=1 \
  --config=/opt/eventstream/config/cluster.yaml"

# Node 2
ssh node2 "/opt/eventstream/event_stream_core \
  --node-id=2 \
  --config=/opt/eventstream/config/cluster.yaml"

# Node 3
ssh node3 "/opt/eventstream/event_stream_core \
  --node-id=3 \
  --config=/opt/eventstream/config/cluster.yaml"
```

### Step 3: Verify Cluster

```bash
# Check cluster status
curl http://10.0.0.1:8080/cluster/status

# Response:
{
  "node_id": 1,
  "state": "leader",
  "term": 1,
  "commit_index": 42,
  "peers": [
    {"id": 2, "state": "follower", "match_index": 42},
    {"id": 3, "state": "follower", "match_index": 42}
  ]
}
```

---

## ğŸ”„ Failover Scenarios

### Leader Failure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Node 1  â”‚     â”‚Node 2  â”‚     â”‚Node 3  â”‚
â”‚ Leader â”‚     â”‚Followerâ”‚     â”‚Followerâ”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚              â”‚              â”‚
    â”‚  Normal operation           â”‚
    â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º  â”‚
    â”‚  Heartbeats                 â”‚
    â”‚              â”‚              â”‚
    â•³              â”‚              â”‚
    â”‚              â”‚              â”‚
 [Node 1          â”‚              â”‚
  crashes]        â”‚              â”‚
                  â”‚              â”‚
    â•³   â”€ â”€ â”€ â”€ â”€ â”¼ â”€ â”€ â”€ â”€ â”€ â”€ â”¤
                  â”‚   No heartbeat for 150ms
                  â”‚              â”‚
                  â”‚  Election timeout
                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚              â”‚
                  â”‚  RequestVote â”‚
                  â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
                  â”‚              â”‚
                  â”‚â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
                  â”‚  VoteGranted â”‚
                  â”‚              â”‚
                  â”‚  Becomes Leader
                  â”‚              â”‚
                  â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
                  â”‚  Heartbeat   â”‚
                  â”‚              â”‚

Total failover time: 150-300ms
```

### Network Partition

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NETWORK PARTITION                                  â”‚
â”‚                                                                      â”‚
â”‚  Before partition:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    Node 1 â•â•â•â•â•â• Node 2 â•â•â•â•â•â• Node 3                       â”‚    â”‚
â”‚  â”‚    Leader        Follower       Follower                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  During partition:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          â•‘                                   â”‚    â”‚
â”‚  â”‚    Node 1 â•â•â•â•â•â• Node 2  â•‘  Node 3                          â”‚    â”‚
â”‚  â”‚    Leader        Follower â•‘  (isolated)                      â”‚    â”‚
â”‚  â”‚    (majority)             â•‘                                  â”‚    â”‚
â”‚  â”‚                          â•‘                                   â”‚    â”‚
â”‚  â”‚    Can still accept       â•‘  Cannot elect leader            â”‚    â”‚
â”‚  â”‚    writes (2/3 quorum)   â•‘  (only 1/3, no quorum)           â”‚    â”‚
â”‚  â”‚                          â•‘                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  After partition heals:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    Node 1 â•â•â•â•â•â• Node 2 â•â•â•â•â•â• Node 3                       â”‚    â”‚
â”‚  â”‚    Leader        Follower       Follower                    â”‚    â”‚
â”‚  â”‚                                 (catches up)                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Monitoring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLUSTER METRICS                                   â”‚
â”‚                                                                      â”‚
â”‚  Key metrics to monitor:                                             â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Metric            â”‚           Description             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ raft_term                â”‚ Current term (increases on elect)â”‚   â”‚
â”‚  â”‚ raft_commit_index        â”‚ Last committed log index         â”‚   â”‚
â”‚  â”‚ raft_apply_index         â”‚ Last applied log index           â”‚   â”‚
â”‚  â”‚ raft_leader              â”‚ Current leader node ID           â”‚   â”‚
â”‚  â”‚ raft_state               â”‚ follower/candidate/leader        â”‚   â”‚
â”‚  â”‚ raft_peers_connected     â”‚ Number of connected peers        â”‚   â”‚
â”‚  â”‚ raft_replication_lag     â”‚ Lag behind leader (entries)      â”‚   â”‚
â”‚  â”‚ raft_elections_total     â”‚ Total elections triggered        â”‚   â”‚
â”‚  â”‚ raft_append_entries_sent â”‚ AppendEntries RPCs sent          â”‚   â”‚
â”‚  â”‚ raft_votes_received      â”‚ Votes received in election       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Alert conditions:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  raft_peers_connected < (cluster_size - 1)  â†’ Node down     â”‚   â”‚
â”‚  â”‚  raft_replication_lag > 100                 â†’ Slow follower â”‚   â”‚
â”‚  â”‚  raft_elections_total rate > 1/min          â†’ Unstable      â”‚   â”‚
â”‚  â”‚  raft_commit_index stuck for > 30s          â†’ Write failure â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Operations

### Add Node

```bash
# 1. Start new node with cluster config
./event_stream_core --node-id=4 --config=cluster.yaml

# 2. Add to cluster via leader
curl -X POST http://leader:8080/cluster/members \
  -d '{"id": 4, "host": "10.0.0.4", "port": 9100}'

# 3. Wait for sync
curl http://leader:8080/cluster/status
# Node 4 should appear with match_index catching up
```

### Remove Node

```bash
# 1. Remove from cluster
curl -X DELETE http://leader:8080/cluster/members/4

# 2. Stop the node
ssh node4 "systemctl stop eventstream"
```

### Rolling Upgrade

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ROLLING UPGRADE SEQUENCE                           â”‚
â”‚                                                                      â”‚
â”‚  Order: Upgrade followers first, leader last                        â”‚
â”‚                                                                      â”‚
â”‚  Step 1: Upgrade Follower 1                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Node 1 (L)    Node 2 (F)    Node 3 (F)                      â”‚   â”‚
â”‚  â”‚  v1.0          v1.0 â†’ v1.1   v1.0                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Step 2: Upgrade Follower 2                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Node 1 (L)    Node 2 (F)    Node 3 (F)                      â”‚   â”‚
â”‚  â”‚  v1.0          v1.1          v1.0 â†’ v1.1                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Step 3: Upgrade Leader (triggers election)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Node 1 (F)    Node 2 (L)    Node 3 (F)                      â”‚   â”‚
â”‚  â”‚  v1.0 â†’ v1.1   v1.1          v1.1                            â”‚   â”‚
â”‚  â”‚                 â–²                                             â”‚   â”‚
â”‚  â”‚                 â”‚ New leader elected                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â¡ï¸ Next

- [Replication Details â†’](replication.md)
